<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Sniper J GM 模擬器 v0.8.3 Final</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f2f2f2;
    }
    h1 {
      color: #2c3e50;
    }
    button {
      margin: 5px;
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      background-color: #3498db;
      color: white;
      border: none;
    }
    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }
    .player {
      background: white;
      margin: 10px 0;
      padding: 10px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .player-info {
      flex-grow: 1;
    }
    .section {
      margin-top: 30px;
    }
    .container {
      max-width: 900px;
      margin: auto;
    }
    .stars {
      font-size: 14px;
      color: gold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🏀 Sniper J GM 模擬器 v0.8.3 Final</h1>
    <div>
      <button id="clearBtn">清空存檔</button>
      <span id="dateDisplay"></span>
      <div id="moneyDisplay"></div>
    </div>
    <div class="section">
      <button id="showWarriorsBtn">勇士陣容</button>
      <button id="simulateGameBtn">模擬比賽</button>
      <button id="resetTrainingBtn">重置訓練</button>
    </div>
    <div id="team"></div>
    <div id="gameResult"></div>
  </div>

<script>
(() => {
  const ratingMap = { "C":1, "C+":2, "B-":3, "B":4, "B+":5, "A-":6, "A":7, "A+":8, "S":9, "S+":10 };
  const ratingStars = r => "★".repeat(Math.min(5, Math.round((ratingMap[r] || 1) / 2)));

  let warriors, money, salaryCap, lastSimDate, firstRoundPicks;

  function defaultData() {
    return {
      warriors: [
        { name:"Stephen Curry", rating:"S", salary:35, trainedToday:false },
        { name:"Klay Thompson", rating:"B+", salary:20, trainedToday:false },
        { name:"Draymond Green", rating:"B", salary:18, trainedToday:false },
        { name:"Jonathan Kuminga", rating:"B", salary:15, trainedToday:false },
        { name:"Andrew Wiggins", rating:"B+", salary:22, trainedToday:false },
        { name:"Moses Moody", rating:"C+", salary:10, trainedToday:false },
        { name:"Gary Payton II", rating:"C+", salary:9, trainedToday:false },
        { name:"Brandin Podziemski", rating:"B-", salary:11, trainedToday:false },
        { name:"Kevon Looney", rating:"C", salary:8, trainedToday:false }
      ],
      money: 100,
      salaryCap: 120,
      lastSimDate: null,
      firstRoundPicks: 1
    };
  }

  function loadData() {
    try {
      const saved = JSON.parse(localStorage.getItem("sj_gm_data") || "null");
      if (saved && saved.warriors) {
        ({ warriors, money, salaryCap, lastSimDate, firstRoundPicks } = saved);
      } else {
        throw new Error("無資料或格式錯誤");
      }
    } catch {
      ({ warriors, money, salaryCap, lastSimDate, firstRoundPicks } = defaultData());
      saveData();
    }
  }

  function saveData() {
    localStorage.setItem("sj_gm_data", JSON.stringify({ warriors, money, salaryCap, lastSimDate, firstRoundPicks }));
  }

  function renderDate() {
    const now = new Date().toLocaleDateString();
    const teamSalary = warriors.reduce((sum, p) => sum + (p.salary || 0), 0);
    const warning = teamSalary > salaryCap ? " ⚠️" : "";
    document.getElementById("dateDisplay").textContent = "｜今天：" + now;
    document.getElementById("moneyDisplay").textContent =
      `｜資金：$${money}M｜團隊工資：${teamSalary}M / 上限：${salaryCap}M${warning}｜首輪籤：${firstRoundPicks}`;
  }

  function resetTraining() {
    warriors.forEach(p => p.trainedToday = false);
    alert("所有球員訓練狀態已重置！");
    saveData();
    showWarriors();
  }

  function simulateGame() {
    const today = new Date().toDateString();
    if (lastSimDate === today) {
      alert("今天已模擬過比賽，請明天再來！");
      return;
    }

    const randomScore = () => Math.round(Math.random() * 50 + 90);
    const teamScore = randomScore();
    const oppScore = randomScore();
    const mvp = warriors.reduce((top, p) => {
      const score = ratingMap[p.rating] * (Math.random() + 0.5);
      return score > top.score ? { name: p.name, score } : top;
    }, { name:"", score:0 });

    document.getElementById("gameResult").innerHTML = `
      <h2>📊 模擬比賽結果</h2>
      <p>🏀 勇士 ${teamScore} : ${oppScore} 對手隊</p>
      <p>🎖 MVP：${mvp.name}</p>
    `;

    lastSimDate = today;
    saveData();
    renderDate();
  }

  function showWarriors() {
    const container = document.getElementById("team");
    container.innerHTML = "<h2>🏀 勇士陣容</h2>" + warriors.map(p => `
      <div class="player">
        <div class="player-info">
          <strong>${p.name}</strong>｜${p.rating}｜${ratingStars(p.rating)}｜$${p.salary}M
          ${p.trainedToday ? "🧠已訓練" : ""}
        </div>
        <button ${p.trainedToday ? "disabled" : ""}>訓練</button>
      </div>
    `).join("");

    container.querySelectorAll("button").forEach((btn, i) => {
      btn.addEventListener("click", () => {
        if (warriors[i].trainedToday) return;
        warriors[i].trainedToday = true;
        alert(`${warriors[i].name} 完成訓練！`);
        saveData();
        showWarriors();
      });
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    loadData();
    renderDate();
    showWarriors();
    document.getElementById("showWarriorsBtn").addEventListener("click", showWarriors);
    document.getElementById("simulateGameBtn").addEventListener("click", simulateGame);
    document.getElementById("resetTrainingBtn").addEventListener("click", resetTraining);
    document.getElementById("clearBtn").addEventListener("click", () => {
      if (confirm("確定清空所有進度？")) {
        localStorage.removeItem("sj_gm_data");
        location.reload();
      }
    });
  });
})();
</script>
</body>
</html>
