<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Sniper J GM æ¨¡æ“¬å™¨ v0.8.3 Final</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f2f2f2;
    }
    h1 {
      color: #2c3e50;
    }
    button {
      margin: 5px;
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      background-color: #3498db;
      color: white;
      border: none;
    }
    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }
    .player {
      background: white;
      margin: 10px 0;
      padding: 10px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .player-info {
      flex-grow: 1;
    }
    .section {
      margin-top: 30px;
    }
    .container {
      max-width: 900px;
      margin: auto;
    }
    .stars {
      font-size: 14px;
      color: gold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ€ Sniper J GM æ¨¡æ“¬å™¨ v0.8.3 Final</h1>
    <div>
      <button id="clearBtn">æ¸…ç©ºå­˜æª”</button>
      <span id="dateDisplay"></span>
      <div id="moneyDisplay"></div>
    </div>
    <div class="section">
      <button id="showWarriorsBtn">å‹‡å£«é™£å®¹</button>
      <button id="simulateGameBtn">æ¨¡æ“¬æ¯”è³½</button>
      <button id="resetTrainingBtn">é‡ç½®è¨“ç·´</button>
    </div>
    <div id="team"></div>
    <div id="gameResult"></div>
  </div>

<script>
(() => {
  const ratingMap = { "C":1, "C+":2, "B-":3, "B":4, "B+":5, "A-":6, "A":7, "A+":8, "S":9, "S+":10 };
  const ratingStars = r => "â˜…".repeat(Math.min(5, Math.round((ratingMap[r] || 1) / 2)));

  let warriors, money, salaryCap, lastSimDate, firstRoundPicks;

  function defaultData() {
    return {
      warriors: [
        { name:"Stephen Curry", rating:"S", salary:35, trainedToday:false },
        { name:"Klay Thompson", rating:"B+", salary:20, trainedToday:false },
        { name:"Draymond Green", rating:"B", salary:18, trainedToday:false },
        { name:"Jonathan Kuminga", rating:"B", salary:15, trainedToday:false },
        { name:"Andrew Wiggins", rating:"B+", salary:22, trainedToday:false },
        { name:"Moses Moody", rating:"C+", salary:10, trainedToday:false },
        { name:"Gary Payton II", rating:"C+", salary:9, trainedToday:false },
        { name:"Brandin Podziemski", rating:"B-", salary:11, trainedToday:false },
        { name:"Kevon Looney", rating:"C", salary:8, trainedToday:false }
      ],
      money: 100,
      salaryCap: 120,
      lastSimDate: null,
      firstRoundPicks: 1
    };
  }

  function loadData() {
    try {
      const saved = JSON.parse(localStorage.getItem("sj_gm_data") || "null");
      if (saved && saved.warriors) {
        ({ warriors, money, salaryCap, lastSimDate, firstRoundPicks } = saved);
      } else {
        throw new Error("ç„¡è³‡æ–™æˆ–æ ¼å¼éŒ¯èª¤");
      }
    } catch {
      ({ warriors, money, salaryCap, lastSimDate, firstRoundPicks } = defaultData());
      saveData();
    }
  }

  function saveData() {
    localStorage.setItem("sj_gm_data", JSON.stringify({ warriors, money, salaryCap, lastSimDate, firstRoundPicks }));
  }

  function renderDate() {
    const now = new Date().toLocaleDateString();
    const teamSalary = warriors.reduce((sum, p) => sum + (p.salary || 0), 0);
    const warning = teamSalary > salaryCap ? " âš ï¸" : "";
    document.getElementById("dateDisplay").textContent = "ï½œä»Šå¤©ï¼š" + now;
    document.getElementById("moneyDisplay").textContent =
      `ï½œè³‡é‡‘ï¼š$${money}Mï½œåœ˜éšŠå·¥è³‡ï¼š${teamSalary}M / ä¸Šé™ï¼š${salaryCap}M${warning}ï½œé¦–è¼ªç±¤ï¼š${firstRoundPicks}`;
  }

  function resetTraining() {
    warriors.forEach(p => p.trainedToday = false);
    alert("æ‰€æœ‰çƒå“¡è¨“ç·´ç‹€æ…‹å·²é‡ç½®ï¼");
    saveData();
    showWarriors();
  }

  function simulateGame() {
    const today = new Date().toDateString();
    if (lastSimDate === today) {
      alert("ä»Šå¤©å·²æ¨¡æ“¬éæ¯”è³½ï¼Œè«‹æ˜å¤©å†ä¾†ï¼");
      return;
    }

    const randomScore = () => Math.round(Math.random() * 50 + 90);
    const teamScore = randomScore();
    const oppScore = randomScore();
    const mvp = warriors.reduce((top, p) => {
      const score = ratingMap[p.rating] * (Math.random() + 0.5);
      return score > top.score ? { name: p.name, score } : top;
    }, { name:"", score:0 });

    document.getElementById("gameResult").innerHTML = `
      <h2>ğŸ“Š æ¨¡æ“¬æ¯”è³½çµæœ</h2>
      <p>ğŸ€ å‹‡å£« ${teamScore} : ${oppScore} å°æ‰‹éšŠ</p>
      <p>ğŸ– MVPï¼š${mvp.name}</p>
    `;

    lastSimDate = today;
    saveData();
    renderDate();
  }

  function showWarriors() {
    const container = document.getElementById("team");
    container.innerHTML = "<h2>ğŸ€ å‹‡å£«é™£å®¹</h2>" + warriors.map(p => `
      <div class="player">
        <div class="player-info">
          <strong>${p.name}</strong>ï½œ${p.rating}ï½œ${ratingStars(p.rating)}ï½œ$${p.salary}M
          ${p.trainedToday ? "ğŸ§ å·²è¨“ç·´" : ""}
        </div>
        <button ${p.trainedToday ? "disabled" : ""}>è¨“ç·´</button>
      </div>
    `).join("");

    container.querySelectorAll("button").forEach((btn, i) => {
      btn.addEventListener("click", () => {
        if (warriors[i].trainedToday) return;
        warriors[i].trainedToday = true;
        alert(`${warriors[i].name} å®Œæˆè¨“ç·´ï¼`);
        saveData();
        showWarriors();
      });
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    loadData();
    renderDate();
    showWarriors();
    document.getElementById("showWarriorsBtn").addEventListener("click", showWarriors);
    document.getElementById("simulateGameBtn").addEventListener("click", simulateGame);
    document.getElementById("resetTrainingBtn").addEventListener("click", resetTraining);
    document.getElementById("clearBtn").addEventListener("click", () => {
      if (confirm("ç¢ºå®šæ¸…ç©ºæ‰€æœ‰é€²åº¦ï¼Ÿ")) {
        localStorage.removeItem("sj_gm_data");
        location.reload();
      }
    });
  });
})();
</script>
</body>
</html>
