<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Sniper J GM æ¨¡æ“¬å™¨ v0.7.5</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f2f2f2; }
    h1 { color: #2c3e50; }
    button { margin: 5px; padding: 10px; font-size: 16px; border-radius: 5px; cursor: pointer; }
    .player { background: white; margin: 10px 0; padding: 10px; border-radius: 6px; display: flex; align-items: center; justify-content: space-between; }
    .player-info { flex-grow: 1; }
    .section { margin-top: 30px; }
    select { padding: 5px 10px; margin-top: 10px; }
    .disabled { opacity: 0.5; pointer-events: none; }
    .container { max-width: 800px; margin: auto; }
    .stars { font-size: 14px; color: gold; }
    .stats { font-size: 12px; color: #555; text-align: right; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ€ Sniper J GM æ¨¡æ“¬å™¨ v0.7.5</h1>
    <div>
      <button id="clearBtn">æ¸…ç©ºå­˜æª”</button>
      <span id="dateDisplay"></span>
      <div id="moneyDisplay"></div>
    </div>
    <div class="section">
      <button id="showWarriorsBtn">å‹‡å£«é™£å®¹</button>
      <button id="showFreeAgentsBtn">è‡ªç”±å¸‚å ´</button>
      <button id="selectTeamBtn">å…¶ä»–éšŠä¼</button>
      <button id="simulateGameBtn">æ¨¡æ“¬æ¯”è³½</button>
      <button id="resetTrainingBtn">é‡ç½®è¨“ç·´</button>
    </div>
    <div id="teamSelectArea"></div>
    <div id="team"></div>
    <div id="freeAgents"></div>
    <div id="otherTeam"></div>
    <div id="gameResult"></div>
  </div>
  <script>
(() => {
  const ratingMap = { "C":1, "C+":2, "B-":3, "B":4, "B+":5, "A-":6, "A":7, "A+":8, "S":9, "S+":10 };
  const ratingStars = r => "â˜…".repeat(Math.min(5, Math.round((ratingMap[r] || 1) / 2)));

  let warriors, freeAgents, otherTeams, money, salaryCap, lastSimDate, picks;

  function defaultData() {
    return {
      warriors: [
        { name:"Stephen Curry", rating:"S", salary:35, trainedToday:false },
        { name:"Klay Thompson", rating:"B+", salary:20, trainedToday:false },
        { name:"Draymond Green", rating:"B", salary:18, trainedToday:false },
        { name:"Jonathan Kuminga", rating:"B", salary:15, trainedToday:false },
        { name:"Andrew Wiggins", rating:"B+", salary:22, trainedToday:false },
        { name:"Moses Moody", rating:"C+", salary:10, trainedToday:false }
      ],
      freeAgents: [
        { name:"Malik Beasley", rating:"B", salary:15, signChance:60 },
        { name:"Robert Covington", rating:"B-", salary:12, signChance:50 }
      ],
      otherTeams: {
        "é›·éœ†": [
          { name:"Shai Gilgeous-Alexander", rating:"S", salary:34 },
          { name:"Jalen Williams", rating:"A", salary:20 },
          { name:"Chet Holmgren", rating:"A-", salary:18 }
        ],
        "é‡‘å¡Š": [
          { name:"Nikola Jokic", rating:"S+", salary:38 },
          { name:"Jamal Murray", rating:"A", salary:27 },
          { name:"Aaron Gordon", rating:"B+", salary:24 }
        ]
      },
      money: 100,
      salaryCap: 120,
      lastSimDate: null,
      picks: 2
    };
  }

  function loadData() {
    try {
      const saved = JSON.parse(localStorage.getItem("sj_gm_data") || "null");
      if (saved) {
        ({ warriors, freeAgents, otherTeams, money, salaryCap, lastSimDate, picks } = saved);
      } else throw new Error();
    } catch {
      ({ warriors, freeAgents, otherTeams, money, salaryCap, lastSimDate, picks } = defaultData());
      saveData();
    }
  }

  function saveData() {
    localStorage.setItem("sj_gm_data", JSON.stringify({ warriors, freeAgents, otherTeams, money, salaryCap, lastSimDate, picks }));
  }

  function getTeamSalary() {
    return warriors.reduce((sum, p) => sum + (p.salary || 0), 0);
  }

  function renderDate() {
    const salary = getTeamSalary();
    const warn = salary > salaryCap ? "âš ï¸" : "";
    document.getElementById("dateDisplay").textContent = "ï½œä»Šå¤©ï¼š" + new Date().toLocaleDateString();
    document.getElementById("moneyDisplay").textContent = `ï½œè³‡é‡‘ï¼š$${money}Mï½œåœ˜éšŠå·¥è³‡ï¼š${salary}M / ä¸Šé™ï¼š${salaryCap}M ${warn}ï½œé¦–è¼ªç±¤ï¼š${picks}`;
  }

  function showWarriors() {
    const container = document.getElementById("team");
    container.innerHTML = "<h2>å‹‡å£«éšŠé™£å®¹</h2>";
    warriors.forEach((p, i) => {
      const trained = p.trainedToday ? "ï¼ˆå·²è¨“ç·´ï¼‰" : "";
      const div = document.createElement("div");
      div.className = "player";
      div.innerHTML = `
        <div class="player-info">
          <strong>${p.name}</strong>ï½œ${p.rating}ï½œ${ratingStars(p.rating)} ${trained}<br/>
          ğŸ’° ${p.salary}M
        </div>
        <div>
          <button ${p.trainedToday ? 'disabled' : ''} onclick="trainPlayer(${i})">è¨“ç·´</button>
          <button onclick="releasePlayer(${i})">é‡‹å‡º</button>
        </div>`;
      container.appendChild(div);
    });
  }

  window.trainPlayer = function(index) {
    const p = warriors[index];
    if (!p.trainedToday && ratingMap[p.rating] < 10) {
      const next = Object.keys(ratingMap)[Object.values(ratingMap).indexOf(ratingMap[p.rating] + 1)];
      p.rating = next;
      p.trainedToday = true;
      alert(`${p.name} æå‡è‡³ ${p.rating}ï¼`);
    } else {
      alert("å·²è¨“ç·´æˆ–å·²é”é ‚ç´šï¼");
    }
    saveData(); showWarriors();
  }

  window.releasePlayer = function(index) {
    const p = warriors[index];
    if (confirm(`ç¢ºå®šè¦é‡‹å‡º ${p.name}ï¼Ÿæ­¤æ“ä½œä¸å¯å›å¾©ï¼`)) {
      warriors.splice(index, 1);
      alert(`${p.name} å·²è¢«é‡‹å‡ºã€‚`);
      saveData(); showWarriors(); renderDate();
    }
  }

  function showFreeAgents() {
    const container = document.getElementById("freeAgents");
    container.innerHTML = "<h2>è‡ªç”±å¸‚å ´</h2>";
    freeAgents.forEach((p, i) => {
      const div = document.createElement("div");
      div.className = "player";
      div.innerHTML = `
        <div class="player-info">
          <strong>${p.name}</strong>ï½œ${p.rating}ï½œ${ratingStars(p.rating)}<br/>
          ğŸ’° ${p.salary}M ï½œç°½ç´„æ©Ÿç‡ï¼š${p.signChance}%
        </div>
        <div>
          <button onclick="signPlayer(${i})">ç°½ä¸‹</button>
        </div>`;
      container.appendChild(div);
    });
  }

  window.signPlayer = function(index) {
    const p = freeAgents[index];
    if (getTeamSalary() + p.salary > salaryCap) return alert("è¶…å‡ºå·¥è³‡ä¸Šé™ï¼");
    if (money < p.salary) return alert("è³‡é‡‘ä¸è¶³ï¼");
    const chance = Math.random() * 100;
    if (chance <= p.signChance) {
      warriors.push({ ...p, trainedToday: false });
      freeAgents.splice(index, 1);
      money -= p.salary;
      alert(`${p.name} æˆåŠŸåŠ å…¥ï¼`);
    } else alert(`${p.name} æ‹’çµ•åŠ ç›Ÿ...`);
    saveData(); renderDate(); showFreeAgents(); showWarriors();
  }

  function selectTeam() {
    const area = document.getElementById("teamSelectArea");
    area.innerHTML = `<h3>é¸æ“‡çƒéšŠï¼š</h3><select id="teamSelect"><option value="">è«‹é¸æ“‡</option>
      ${Object.keys(otherTeams).map(t => `<option value="${t}">${t}</option>`).join("")}
    </select>`;
    document.getElementById("teamSelect").onchange = e => showOtherTeam(e.target.value);
  }

  function showOtherTeam(team) {
    const players = otherTeams[team];
    const container = document.getElementById("otherTeam");
    container.innerHTML = `<h2>${team} çƒå“¡</h2>`;
    players.forEach((p, i) => {
      const div = document.createElement("div");
      div.className = "player";
      div.innerHTML = `
        <div class="player-info">
          <strong>${p.name}</strong>ï½œ${p.rating}ï½œ${ratingStars(p.rating)}<br/>ğŸ’° ${p.salary}M
        </div>
        <div><button onclick="multiTrade('${team}', ${i})">å¤šæ›ä¸€äº¤æ˜“</button></div>`;
      container.appendChild(div);
    });
  }

  window.multiTrade = function(team, index) {
    const target = otherTeams[team][index];
    let promptMsg = `ä½ æƒ³ç”¨å“ªäº›å‹‡å£«çƒå“¡äº¤æ˜“ ${target.name}ï¼Ÿï¼ˆæœ€å¤š3äººï¼Œç”¨,åˆ†éš”åå­—ï¼‰\n`;
    warriors.forEach(p => promptMsg += `- ${p.name}\n`);
    promptMsg += `ä½ é‚„å¯ä»¥æ‰“ã€Œé¦–è¼ªç±¤ã€åŠ å…¥äº¤æ˜“`;
    const input = prompt(promptMsg);
    if (!input) return;
    const items = input.split(",").map(s => s.trim());
    const usePick = items.includes("é¦–è¼ªç±¤");
    const selected = warriors.filter(p => items.includes(p.name));
    if (selected.length === 0 && !usePick) return alert("æ²’æœ‰æœ‰æ•ˆäº¤æ˜“é …ç›®");

    const giveSalary = selected.reduce((sum, p) => sum + p.salary, 0);
    const total = giveSalary + (usePick ? 5 : 0); // pickå€¼ç´„ç­‰æ–¼5M
    if (total >= target.salary) {
      selected.forEach(p => {
        const i = warriors.findIndex(x => x.name === p.name);
        if (i !== -1) warriors.splice(i, 1);
      });
      if (usePick && picks > 0) picks--;
      warriors.push({ ...target, trainedToday: false });
      otherTeams[team].splice(index, 1);
      alert(`äº¤æ˜“æˆåŠŸï¼ä½ ç²å¾—äº† ${target.name}`);
    } else {
      alert("ä½ æä¾›çš„ç±Œç¢¼ä¸å¤ æœ‰èª æ„ï¼");
    }
    saveData(); showWarriors(); showOtherTeam(team); renderDate();
  }

  function simulateGame() {
    const today = new Date().toLocaleDateString();
    if (lastSimDate === today) return alert("ä»Šå¤©å·²æ¨¡æ“¬éä¸€å ´æ¯”è³½ï¼");
    const score = warriors.reduce((sum, p) => sum + ratingMap[p.rating] + Math.floor(Math.random() * 5), 0);
    const [oppName, oppTeam] = Object.entries(otherTeams)[Math.floor(Math.random() * Object.keys(otherTeams).length)];
    const oppScore = oppTeam.reduce((sum, p) => sum + ratingMap[p.rating] + Math.floor(Math.random() * 5), 0);
    document.getElementById("gameResult").innerHTML = `<h2>æ¯”è³½çµæœ</h2>
      <p>å‹‡å£« vs ${oppName}</p><p>æ¯”åˆ†ï¼š${score} - ${oppScore}</p>
      <p>${score > oppScore ? "ğŸ‰ å‹åˆ©ï¼" : "ğŸ’” è½æ•—..."}</p>`;
    lastSimDate = today;
    saveData(); renderDate();
  }

  function resetTraining() {
    warriors.forEach(p => p.trainedToday = false);
    alert("è¨“ç·´å·²é‡ç½®ï¼");
    saveData(); showWarriors();
  }

  document.addEventListener("DOMContentLoaded", () => {
    loadData(); renderDate(); showWarriors();
    document.getElementById("showWarriorsBtn").onclick = showWarriors;
    document.getElementById("showFreeAgentsBtn").onclick = showFreeAgents;
    document.getElementById("selectTeamBtn").onclick = selectTeam;
    document.getElementById("simulateGameBtn").onclick = simulateGame;
    document.getElementById("resetTrainingBtn").onclick = resetTraining;
    document.getElementById("clearBtn").onclick = () => {
      if (confirm("æ¸…é™¤æ‰€æœ‰é€²åº¦ï¼Ÿ")) {
        localStorage.removeItem("sj_gm_data"); location.reload();
      }
    };
  });
})();
</script>
</body>
</html>