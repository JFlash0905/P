<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Sniper J GM æ¨¡æ“¬å™¨ v0.7.8</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f2f2f2; }
    h1 { color: #2c3e50; }
    button { margin: 5px; padding: 10px; font-size: 16px; border-radius: 5px; cursor: pointer; }
    .player { background: white; margin: 10px 0; padding: 10px; border-radius: 6px; display: flex; align-items: center; justify-content: space-between; }
    .player-info { flex-grow: 1; }
    .section { margin-top: 30px; }
    select { padding: 5px 10px; margin-top: 10px; }
    .disabled { opacity: 0.5; pointer-events: none; }
    .container { max-width: 800px; margin: auto; }
    .stars { font-size: 14px; color: gold; }
    .stats { font-size: 12px; color: #555; text-align: right; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ€ Sniper J GM æ¨¡æ“¬å™¨ v0.7.8</h1>
    <div>
      <button id="clearBtn">æ¸…ç©ºå­˜æª”</button>
      <span id="dateDisplay"></span>
      <div id="moneyDisplay"></div>
    </div>
    <div class="section">
      <button id="showWarriorsBtn">å‹‡å£«é™£å®¹</button>
      <button id="showFreeAgentsBtn">è‡ªç”±å¸‚å ´</button>
      <button id="selectTeamBtn">å…¶ä»–éšŠä¼</button>
      <button id="simulateGameBtn">æ¨¡æ“¬æ¯”è³½</button>
      <button id="resetTrainingBtn">é‡ç½®è¨“ç·´</button>
    </div>
    <div id="teamSelectArea"></div>
    <div id="team"></div>
    <div id="freeAgents"></div>
    <div id="otherTeam"></div>
    <div id="gameResult"></div>
  </div>

  <script>
    (() => {
      const ratingMap = { "C": 1, "C+": 2, "B-": 3, "B": 4, "B+": 5, "A-": 6, "A": 7, "A+": 8, "S": 9, "S+": 10 };
      const ratingStars = (r) => "â˜…".repeat(Math.min(5, Math.round((ratingMap[r] || 1) / 2)));

      let warriors = [];
      let freeAgents = [];
      let otherTeams = {};
      let money = 100;
      let salaryCap = 120;
      let lastSimDate = null;
      let firstRoundPicks = 1;

      function defaultData() {
        return {
          warriors: [
            { name: "Stephen Curry", rating: "S", salary: 35, trainedToday: false },
            { name: "Klay Thompson", rating: "B+", salary: 20, trainedToday: false },
            { name: "Draymond Green", rating: "B", salary: 18, trainedToday: false },
            { name: "Jonathan Kuminga", rating: "B", salary: 15, trainedToday: false },
            { name: "Andrew Wiggins", rating: "B+", salary: 22, trainedToday: false },
            { name: "Moses Moody", rating: "C+", salary: 10, trainedToday: false }
          ],
          freeAgents: [
            { name: "Malik Beasley", rating: "B", salary: 15, signChance: 60 },
            { name: "Robert Covington", rating: "B-", salary: 12, signChance: 50 }
          ],
          otherTeams: {
            "é›·éœ†": [
              { name: "Shai Gilgeous-Alexander", rating: "S", salary: 34 },
              { name: "Jalen Williams", rating: "A", salary: 20 },
              { name: "Chet Holmgren", rating: "A-", salary: 18 }
            ],
            "ç°ç‹¼": [
              { name: "Anthony Edwards", rating: "S", salary: 32 },
              { name: "Karl-Anthony Towns", rating: "A", salary: 28 },
              { name: "Rudy Gobert", rating: "B+", salary: 25 }
            ],
            "é‡‘å¡Š": [
              { name: "Nikola Jokic", rating: "S+", salary: 38 },
              { name: "Jamal Murray", rating: "A", salary: 27 },
              { name: "Aaron Gordon", rating: "B+", salary: 24 }
            ]
          },
          money: 100,
          salaryCap: 120,
          lastSimDate: null,
          firstRoundPicks: 1
        };
      }

      function loadData() {
        try {
          const saved = JSON.parse(localStorage.getItem("sj_gm_data") || "null");
          if (saved && saved.warriors && saved.freeAgents && saved.otherTeams) {
            warriors = saved.warriors;
            freeAgents = saved.freeAgents;
            otherTeams = saved.otherTeams;
            money = saved.money;
            salaryCap = saved.salaryCap;
            lastSimDate = saved.lastSimDate;
            firstRoundPicks = saved.firstRoundPicks ?? 1;
          } else {
            throw new Error("éœ€è¦é‡è¨­");
          }
        } catch {
          const defaults = defaultData();
          warriors = defaults.warriors;
          freeAgents = defaults.freeAgents;
          otherTeams = defaults.otherTeams;
          money = defaults.money;
          salaryCap = defaults.salaryCap;
          lastSimDate = defaults.lastSimDate;
          firstRoundPicks = defaults.firstRoundPicks;
          saveData();
        }
      }

      function saveData() {
        localStorage.setItem("sj_gm_data", JSON.stringify({ warriors, freeAgents, otherTeams, money, salaryCap, lastSimDate, firstRoundPicks }));
      }

      function renderDate() {
        const now = new Date().toLocaleDateString();
        const salary = getTeamSalary();
        const luxury = salary > salaryCap ? " âš ï¸" : "";
        document.getElementById("dateDisplay").textContent = `ï½œä»Šå¤©ï¼š${now}`;
        document.getElementById("moneyDisplay").textContent = `ï½œè³‡é‡‘ï¼š$${money}Mï½œåœ˜éšŠå·¥è³‡ï¼š${salary}M / ä¸Šé™ï¼š${salaryCap}M${luxury}ï½œé¦–è¼ªç±¤ï¼š${firstRoundPicks}`;
      }

      function getTeamSalary() {
        return warriors.reduce((sum, p) => sum + (p.salary || 0), 0);
      }
            function showWarriors() {
        const container = document.getElementById("team");
        container.innerHTML = "<h2>å‹‡å£«éšŠé™£å®¹</h2>";
        warriors.forEach((p, i) => {
          const trained = p.trainedToday ? "ï¼ˆå·²è¨“ç·´ï¼‰" : "";
          const div = document.createElement("div");
          div.className = "player";
          div.innerHTML = `
            <div class="player-info">
              <strong>${p.name}</strong>ï½œ${p.rating}ï½œ${ratingStars(p.rating)} ${trained}<br/>
              ğŸ’° ${p.salary}M
            </div>
            <div>
              <button ${p.trainedToday ? 'disabled' : ''} onclick="trainPlayer(${i})">è¨“ç·´</button>
              <button onclick="releasePlayer(${i})">é‡‹å‡º</button>
            </div>`;
          container.appendChild(div);
        });
      }

      window.trainPlayer = function(index) {
        const p = warriors[index];
        if (!p.trainedToday && ratingMap[p.rating] < 10) {
          const nextRating = Object.keys(ratingMap)[Object.values(ratingMap).indexOf(ratingMap[p.rating] + 1)];
          p.rating = nextRating;
          p.trainedToday = true;
          alert(`${p.name} è©•åƒ¹æå‡ç‚º ${p.rating}ï¼`);
        } else {
          alert("å·²è¨“ç·´éæˆ–å·²é”é ‚ç´šï¼");
        }
        saveData();
        showWarriors();
      };

      window.releasePlayer = function(index) {
        const p = warriors[index];
        if (confirm(`ç¢ºèªè¦é‡‹å‡º ${p.name} å—ï¼Ÿå°‡ä¸è¿”é‚„è–ªè³‡ã€‚`)) {
          warriors.splice(index, 1);
          saveData();
          showWarriors();
          renderDate();
        }
      };

      function showFreeAgents() {
        const container = document.getElementById("freeAgents");
        container.innerHTML = "<h2>è‡ªç”±å¸‚å ´</h2>";
        freeAgents.forEach((p, i) => {
          const div = document.createElement("div");
          div.className = "player";
          div.innerHTML = `
            <div class="player-info">
              <strong>${p.name}</strong>ï½œ${p.rating}ï½œ${ratingStars(p.rating)}<br/>
              ğŸ’° ${p.salary}M ï½œç°½ç´„æ©Ÿç‡ï¼š${p.signChance}%
            </div>
            <div>
              <button onclick="signPlayer(${i})">ç°½ä¸‹</button>
            </div>`;
          container.appendChild(div);
        });
      }

      window.signPlayer = function(index) {
        const p = freeAgents[index];
        if (getTeamSalary() + p.salary > salaryCap) return alert("è¶…å‡ºå·¥è³‡ä¸Šé™ï¼");
        if (money < p.salary) return alert("è³‡é‡‘ä¸è¶³ï¼");
        const chance = Math.random() * 100;
        if (chance <= p.signChance) {
          warriors.push({ ...p, trainedToday: false });
          freeAgents.splice(index, 1);
          money -= p.salary;
          alert(`${p.name} æˆåŠŸåŠ å…¥ï¼`);
        } else {
          alert(`${p.name} æ‹’çµ•åŠ å…¥...`);
        }
        saveData();
        renderDate();
        showFreeAgents();
        showWarriors();
      };

      function selectTeam() {
        const area = document.getElementById("teamSelectArea");
        area.innerHTML = `<h3>é¸æ“‡çƒéšŠï¼š</h3><select id="teamSelect"><option value="">è«‹é¸æ“‡</option>
          ${Object.keys(otherTeams).map(t => `<option value="${t}">${t}</option>`).join("")}
        </select>`;
        document.getElementById("teamSelect").onchange = (e) => showOtherTeam(e.target.value);
      }

      function showOtherTeam(team) {
        const players = otherTeams[team];
        const container = document.getElementById("otherTeam");
        container.innerHTML = `<h2>${team} çƒå“¡</h2>`;
        players.forEach((p, i) => {
          const div = document.createElement("div");
          div.className = "player";
          div.innerHTML = `
            <div class="player-info">
              <strong>${p.name}</strong>ï½œ${p.rating}ï½œ${ratingStars(p.rating)}<br/>ğŸ’° ${p.salary}M
            </div>
            <div><button onclick="tradeFor('${team}', ${i})">äº¤æ˜“</button></div>`;
          container.appendChild(div);
        });
      }

      window.tradeFor = function(team, index) {
        const target = otherTeams[team][index];
        const choices = warriors.map(p => p.name).join("\n");
        const name = prompt(`è¼¸å…¥è¦äº¤æ˜“å‡ºå»çš„å‹‡å£«çƒå“¡ï¼ˆå¯ç”¨ +draft åŠ ä¸Šé¦–è¼ªç±¤ï¼‰ï¼š\n${choices}`);
        if (!name) return;
        const usePick = name.includes("+draft");
        const cleanName = name.replace("+draft", "").trim();
        const idx = warriors.findIndex(p => p.name === cleanName);
        if (idx >= 0) {
          const traded = warriors[idx];
          // å¤šæ›ä¸€åŠŸèƒ½
          const multi = confirm("æ˜¯å¦å¤šæ›ä¸€ä½å°æ–¹çƒå“¡ï¼Ÿ");
          let second = null;
          if (multi) {
            const secondChoices = otherTeams[team].map(p => p.name).join("\n");
            const secondName = prompt(`è¼¸å…¥è¦å¤šæ›çš„ç¬¬äºŒä½çƒå“¡ï¼š\n${secondChoices}`);
            const secondIndex = otherTeams[team].findIndex(p => p.name === secondName);
            if (secondIndex >= 0) {
              second = otherTeams[team].splice(secondIndex, 1)[0];
              warriors.push(second);
            }
          }
          // æ ¸å¿ƒäº¤æ˜“é‚è¼¯
          otherTeams[team][index] = traded;
          warriors[idx] = target;
          if (usePick && firstRoundPicks > 0) {
            firstRoundPicks -= 1;
            alert(`äº¤æ˜“æˆåŠŸï¼š${traded.name} + é¦–è¼ªç±¤ âœ ${target.name}${second ? " + " + second.name : ""}`);
          } else if (usePick) {
            alert("ä½ æ²’æœ‰è¶³å¤ çš„é¦–è¼ªç±¤ï¼");
            return;
          } else {
            alert(`æˆåŠŸäº¤æ˜“ ${traded.name} æ›ä¾† ${target.name}${second ? " + " + second.name : ""}`);
          }
          saveData();
          showWarriors();
          showOtherTeam(team);
          renderDate();
        } else {
          alert("æ‰¾ä¸åˆ°è©²çƒå“¡ï¼");
        }
      };
            function simulateGame() {
        const today = new Date().toLocaleDateString();
        if (lastSimDate === today) return alert("ä»Šå¤©å·²æ¨¡æ“¬éæ¯”è³½ï¼");
        const score = warriors.reduce((sum, p) => sum + ratingMap[p.rating] + Math.floor(Math.random() * 5), 0);
        const [teamName, players] = Object.entries(otherTeams)[Math.floor(Math.random() * Object.keys(otherTeams).length)];
        const oppScore = players.reduce((sum, p) => sum + ratingMap[p.rating] + Math.floor(Math.random() * 5), 0);
        const result = document.getElementById("gameResult");
        result.innerHTML = `<h2>æ¨¡æ“¬æ¯”è³½çµæœ</h2>
          <p>å‹‡å£« vs ${teamName}</p>
          <p>æ¯”åˆ†ï¼š${score} - ${oppScore}</p>
          <p>${score > oppScore ? "ğŸ‰ å‹‡å£«å‹åˆ©ï¼" : "ğŸ˜¢ å‹‡å£«è½æ•—..."}</p>`;
        lastSimDate = today;
        saveData();
        renderDate();
      }

      function resetTraining() {
        warriors.forEach(p => p.trainedToday = false);
        alert("è¨“ç·´å·²é‡ç½®ï¼");
        saveData();
        showWarriors();
      }

      // åˆå§‹åŒ–
      document.addEventListener("DOMContentLoaded", () => {
        loadData();
        renderDate();
        showWarriors();
        document.getElementById("showWarriorsBtn").onclick = showWarriors;
        document.getElementById("showFreeAgentsBtn").onclick = showFreeAgents;
        document.getElementById("selectTeamBtn").onclick = selectTeam;
        document.getElementById("simulateGameBtn").onclick = simulateGame;
        document.getElementById("resetTrainingBtn").onclick = resetTraining;
        document.getElementById("clearBtn").onclick = () => {
          if (confirm("æ¸…é™¤æ‰€æœ‰é€²åº¦ï¼Ÿ")) {
            localStorage.removeItem("sj_gm_data");
            location.reload();
          }
        };
      });
    })();
  </script>
</body>
</html>