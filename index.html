<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Sniper J GM 模擬器 v0.7.2</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f2f2f2; }
    h1 { color: #2c3e50; }
    button { margin: 5px; padding: 10px; font-size: 16px; border-radius: 5px; cursor: pointer; }
    .player { background: white; margin: 10px 0; padding: 10px; border-radius: 6px; display: flex; align-items: center; }
    .player-card { width: 50px; height: 50px; background: #eee; margin-right: 10px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
    .section { margin-top: 20px; }
    select { padding: 5px 10px; margin-top: 10px; }
    .disabled { opacity: 0.5; pointer-events: none; }
    #salaryInfo { margin-top: 10px; font-weight: bold; color: #2c3e50; }
    .container { max-width: 800px; margin: auto; }
  </style>
</head>
<body>
  <div class="container">
    <h1>🏀 Sniper J GM 模擬器 v0.7.2</h1>
    <div>
      <button id="clearBtn">清空存檔</button>
      <span id="dateDisplay"></span>
    </div>
    <div class="section">
      <button id="showWarriorsBtn">勇士陣容</button>
      <button id="showFreeAgentsBtn">自由市場</button>
      <button id="selectTeamBtn">其他隊伍</button>
      <button id="simulateGameBtn">模擬比賽</button>
      <button id="resetTrainingBtn">重置訓練</button>
      <div id="teamSelectArea"></div>
    </div>
    <div id="salaryInfo"></div>
    <div id="team"></div>
    <div id="freeAgents"></div>
    <div id="otherTeam"></div>
    <div id="gameResult"></div>
    <div id="logs"></div>
  </div>

  <script>
  (function(){
    let warriors, freeAgents, otherTeams, money, salaryCap, lastSimDate;
    const ratingMap = { "C":1,"C+":2,"B-":3,"B":4,"B+":5,"A-":6,"A":7,"A+":8,"S":9,"S+":10 };
    const baseWage = 10;  // 每個 "⭐" 為基本薪資單位

    const otherTeamData = {
      "雷霆":[{name:"Shai Gilgeous-Alexander",rating:"S"},{name:"Jalen Williams",rating:"A"},{name:"Chet Holmgren",rating:"A-"}],
      "灰狼":[{name:"Anthony Edwards",rating:"S"},{name:"Rudy Gobert",rating:"B+"},{name:"Karl-Anthony Towns",rating:"A"}],
      "金塊":[{name:"Nikola Jokic",rating:"S+"},{name:"Jamal Murray",rating:"A"},{name:"Aaron Gordon",rating:"B+"}]
    };

    function loadData(){
      const s = JSON.parse(localStorage.getItem("sj_gm_data")||"null");
      if(s){
        ({warriors,freeAgents,otherTeams,money,salaryCap,lastSimDate}=s);
      } else {
        money = 100; salaryCap = 120; lastSimDate = null;
        warriors = [
          {name:"Stephen Curry",rating:"S",trainedToday:false},
          {name:"Klay Thompson",rating:"B+",trainedToday:false},
          {name:"Draymond Green",rating:"B",trainedToday:false},
          {name:"Jonathan Kuminga",rating:"B",trainedToday:false},
          {name:"Andrew Wiggins",rating:"B+",trainedToday:false}
        ];
        freeAgents = [
          {name:"Malik Beasley",rating:"B",signChance:60},
          {name:"Robert Covington",rating:"B-",signChance:50}
        ];
        otherTeams = structuredClone(otherTeamData);
      }
    }

    function saveData(){
      localStorage.setItem("sj_gm_data", JSON.stringify({warriors,freeAgents,otherTeams,money,salaryCap,lastSimDate}));
    }

    function renderDate(){
      document.getElementById("dateDisplay").textContent = "今天："+ new Date().toLocaleDateString();
    }

    function calcTeamWage(){
      return warriors.reduce((sum,p)=> sum + ratingMap[p.rating]*baseWage, 0);
    }

    function renderSalary(){
      document.getElementById("salaryInfo").textContent =
        `💰 團隊工資：${calcTeamWage()} / 上限：${salaryCap}M`;
    }

    function showWarriors(){
      const c = document.getElementById("team");
      c.innerHTML = "<h2>勇士陣容</h2>";
      warriors.forEach((p,i)=>{
        const star = "⭐".repeat(ratingMap[p.rating]);
        const btn = p.trainedToday ?
          `<button class="disabled">訓練</button>` :
          `<button onclick="trainPlayer(${i})">訓練</button>`;
        c.innerHTML += `
          <div class="player">
            <div class="player-card">${p.name[0]}</div>
            <div><strong>${p.name}</strong> - ${p.rating} ${p.trainedToday?"（已訓練）":""}<br>${star}</div>
            <div class="stats">薪資：${ratingMap[p.rating]*baseWage}M</div>
            ${btn}
          </div>`;
      });
      renderSalary();
    }

    window.trainPlayer = function(i){
      if(warriors[i].trainedToday){ alert("今日已訓練"); return; }
      const list = Object.keys(ratingMap);
      let idx = list.indexOf(warriors[i].rating);
      if(idx < list.length -1){
        warriors[i].rating = list[idx+1];
        warriors[i].trainedToday = true;
        alert(`${warriors[i].name} 評價升為 ${warriors[i].rating}！`);
      } else {
        alert("已是最高！");
      }
      showWarriors();
      saveData();
    }

    function resetTraining(){
      warriors.forEach(p=>p.trainedToday=false);
      alert("今日訓練重置！");
      showWarriors();
      saveData();
    }

    function simulateGameAuto(today){
      let ours=0, opps=0;
      warriors.forEach(p=> ours += ratingMap[p.rating] + Math.random()*5|0 );
      const allOthers = Object.values(otherTeams).flat();
      const opp = allOthers[Math.random()*allOthers.length|0];
      opps = ratingMap[opp.rating] + Math.random()*10|0;
      document.getElementById("gameResult").innerHTML = `
        <h3>比賽結果</h3>
        <p>勇士 ${ours} : ${opps} ${opp.name}</p>
        <p>${ours>opps ? "🎉 勝利！" : "💔 落敗..."}</p>`;
      lastSimDate = today;
      saveData();
    }

    function showFreeAgents(){
      const c = document.getElementById("freeAgents");
      c.innerHTML = "<h2>自由市場</h2>";
      freeAgents.forEach((p,i)=>{
        const chance = Math.max(5, p.signChance - ratingMap[p.rating]);
        c.innerHTML += `
          <div class="player">
            <div class="player-card">${p.name[0]}</div>
            <div><strong>${p.name}</strong> - ${p.rating}<br>簽約率：約${chance}%</div>
            <button onclick="signFreeAgent(${i},${chance})">簽下</button>
          </div>`;
      });
    }

    window.signFreeAgent = function(i,ch){
      if(Math.random()*100 <= ch){
        warriors.push({...freeAgents[i],trainedToday:false});
        alert(`${freeAgents[i].name} 加入軍團！`);
        freeAgents.splice(i,1);
      } else {
        alert("簽約失敗...");
      }
      showFreeAgents(); showWarriors();
      saveData();
    }

    function selectTeam(){
      const area = document.getElementById("teamSelectArea");
      area.innerHTML = `
        <h3>選隊伍看陣容：</h3>
        <select id="teamSelect"><option value="">請選擇</option>
        ${Object.keys(otherTeams).map(t=>`<option value="${t}">${t}</option>`).join("")}
        </select>`;
      document.getElementById("teamSelect").addEventListener("change", e=>showOtherTeam(e.target.value));
    }

    function showOtherTeam(name){
      const c = document.getElementById("otherTeam");
      if(!name){ c.innerHTML=""; return; }
      const arr=otherTeams[name];
      c.innerHTML = `<h2>${name} 陣容</h2>`;
      arr.forEach(p=>{
        c.innerHTML += `
          <div class="player">
            <div class="player-card">${p.name[0]}</div>
            <div><strong>${p.name}</strong> - ${p.rating}<br>⭐${ratingMap[p.rating]}</div>
          </div>`;
      });
    }

    document.addEventListener("DOMContentLoaded",()=>{
      loadData(); renderDate(); showWarriors(); showFreeAgents();
      document.getElementById("showWarriorsBtn").onclick = showWarriors;
      document.getElementById("showFreeAgentsBtn").onclick = showFreeAgents;
      document.getElementById("selectTeamBtn").onclick = selectTeam;
      document.getElementById("simulateGameBtn").onclick = ()=>{
        const today = new Date().toLocaleDateString();
        if(lastSimDate===today) return alert("今天已模擬過！");
        simulateGameAuto(today);
      };
      document.getElementById("resetTrainingBtn").onclick = resetTraining;
      document.getElementById("clearBtn").onclick = ()=>{
        if(confirm("清除所有資料？")) localStorage.removeItem("sj_gm_data"), location.reload();
      };
    });
  })();
  </script>
</body>
</html>