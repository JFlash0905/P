<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Sniper J GM æ¨¡æ“¬å™¨ v0.7.1</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f2f2f2; }
    h1 { color: #2c3e50; }
    button { margin: 5px; padding: 10px; font-size: 16px; border-radius: 5px; cursor: pointer; }
    .player { background: white; margin: 10px 0; padding: 10px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; }
    .player-card { width: 60px; height: 60px; background: #eee; margin-right: 10px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
    .section { margin-top: 30px; }
    select { padding: 5px 10px; margin-top: 10px; }
    .disabled { opacity: 0.5; pointer-events: none; }
    .container { max-width: 800px; margin: auto; }
    .stats { font-size: 12px; color: #555; text-align: right; }
  </style>
</head>
<body>
<div class="container">
  <h1>ğŸ€ Sniper J GM æ¨¡æ“¬å™¨ v0.7.1</h1>
  <div>
    <button id="clearBtn">æ¸…ç©ºå­˜æª”</button> 
    <span id="dateDisplay"></span> 
    <span id="statusDisplay" style="float:right;"></span>
  </div>
  <div class="section">
    <button id="showWarriorsBtn">å‹‡å£«é™£å®¹</button>
    <button id="showFreeAgentsBtn">è‡ªç”±å¸‚å ´</button>
    <button id="selectTeamBtn">å…¶ä»–éšŠä¼</button>
    <button id="simulateGameBtn">æ¨¡æ“¬æ¯”è³½</button>
    <button id="resetTrainingBtn">é‡ç½®è¨“ç·´</button>
    <div id="teamSelectArea"></div>
  </div>
  <div id="team"></div>
  <div id="freeAgents"></div>
  <div id="otherTeam"></div>
  <div id="gameResult"></div>
</div>

<script>
(() => {
  const ratingMap = { "C":1,"C+":2,"B-":3,"B":4,"B+":5,"A-":6,"A":7,"A+":8,"S":9,"S+":10 };
  let warriors, freeAgents, otherTeams, money, salaryCap, lastSimDate;

  function loadData() {
    const saved = JSON.parse(localStorage.getItem("sj_gm_data")||"null");
    if (saved) {
      ({warriors, freeAgents, otherTeams, money, salaryCap, lastSimDate} = saved);
    } else {
      money = 100;
      salaryCap = 120;
      lastSimDate = null;
      warriors = [
        { name:"Stephen Curry", rating:"S", trainedToday:false },
        { name:"Klay Thompson", rating:"B+", trainedToday:false },
        { name:"Draymond Green", rating:"B", trainedToday:false },
        { name:"Jonathan Kuminga", rating:"B", trainedToday:false },
        { name:"Andrew Wiggins", rating:"B+", trainedToday:false },
        { name:"Moses Moody", rating:"C+", trainedToday:false }
      ];
      freeAgents = [
        { name:"Malik Beasley", rating:"B", signChance:40 },
        { name:"Robert Covington", rating:"B-", signChance:35 },
        { name:"Kelly Oubre Jr.", rating:"B+", signChance:30 }
      ];
      otherTeams = {
        "é›·éœ†": [
          { name:"Shai Gilgeous-Alexander", rating:"S" },
          { name:"Jalen Williams", rating:"A" },
          { name:"Chet Holmgren", rating:"A-" }
        ],
        "ç°ç‹¼": [
          { name:"Anthony Edwards", rating:"S" },
          { name:"Rudy Gobert", rating:"B+" },
          { name:"KAT", rating:"A" }
        ],
        "é‡‘å¡Š": [
          { name:"Jokic", rating:"S+" },
          { name:"Jamal Murray", rating:"A" },
          { name:"Aaron Gordon", rating:"B+" }
        ],
        "ç°ç†Š": [
          { name:"Ja Morant", rating:"S" },
          { name:"JJJ", rating:"A" },
          { name:"Bane", rating:"A-" }
        ],
        "ç†±ç«": [
          { name:"Bam Adebayo", rating:"A+" },
          { name:"Herro", rating:"A-" },
          { name:"Jaquez Jr.", rating:"B+" }
        ]
      };
    }
  }

  function saveData() {
    localStorage.setItem("sj_gm_data", JSON.stringify({warriors, freeAgents, otherTeams, money, salaryCap, lastSimDate}));
  }

  function renderDate() {
    const now = new Date();
    const todayStr = now.toLocaleDateString();
    document.getElementById("dateDisplay").textContent = `ä»Šå¤©ï¼š${todayStr}`;
    document.getElementById("statusDisplay").textContent = `ğŸ’° è³‡é‡‘ï¼š$${money}Mï½œå·¥è³‡ä¸Šé™ï¼š${salaryCap}M`;
    if (lastSimDate !== todayStr) simulateGameAuto(todayStr);
  }

  function getStar(rating){
    const val = ratingMap[rating] || 1;
    return "â˜…".repeat(Math.floor(val/2)) + (val%2 ? "â˜†" : "");
  }

  function showWarriors() {
    const div = document.getElementById("team");
    div.innerHTML = "<h2>å‹‡å£«éšŠé™£å®¹</h2>";
    warriors.forEach((p, i) => {
      const trainedText = p.trainedToday ? 'ï¼ˆå·²è¨“ç·´ï¼‰' : '';
      const star = getStar(p.rating);
      div.innerHTML += `
        <div class="player">
          <div><strong>${p.name}</strong>ï½œè©•åƒ¹ï¼š${p.rating} ${star} ${trainedText}</div>
          <div class="stats">
            <button ${p.trainedToday?"disabled":""} onclick="trainPlayer(${i})">Curry Styleè¨“ç·´</button>
          </div>
        </div>`;
    });
  }

  window.trainPlayer = (i) => {
    const p = warriors[i];
    if (p.trainedToday) return alert("ä»Šå¤©å·²è¨“ç·´éï¼");
    let idx = Object.keys(ratingMap).indexOf(p.rating);
    if (idx < Object.keys(ratingMap).length - 1) {
      p.rating = Object.keys(ratingMap)[idx + 1];
      p.trainedToday = true;
      money -= 2;
      alert(`${p.name} å®Œæˆ Curry Style è¨“ç·´ï¼è©•åƒ¹å‡ç‚º ${p.rating}`);
    } else {
      alert(`${p.name} å·²é”æœ€é«˜è©•åƒ¹ï¼`);
    }
    showWarriors(); saveData();
  };

  function showFreeAgents() {
    const div = document.getElementById("freeAgents");
    div.innerHTML = "<h2>è‡ªç”±å¸‚å ´</h2>";
    freeAgents.forEach((p, i) => {
      const chance = Math.max(10, p.signChance - warriors.length);
      const star = getStar(p.rating);
      div.innerHTML += `
        <div class="player">
          <div><strong>${p.name}</strong>ï½œè©•åƒ¹ï¼š${p.rating} ${star}</div>
          <div class="stats">
            <button onclick="signFA(${i}, ${chance})">ç°½ä¸‹ï¼ˆæ©Ÿç‡${chance}%ï¼‰</button>
          </div>
        </div>`;
    });
  }

  window.signFA = (i, chance) => {
    const p = freeAgents[i];
    const roll = Math.random() * 100;
    if (roll <= chance) {
      warriors.push({...p, trainedToday:false});
      money -= 5;
      alert(`${p.name} æˆåŠŸåŠ å…¥å‹‡å£«ï¼`);
      freeAgents.splice(i,1);
    } else {
      alert(`${p.name} æ‹’çµ•äº†ä½ çš„é‚€è«‹...`);
    }
    showFreeAgents(); showWarriors(); saveData();
  };

  function simulateGameAuto(todayStr){
    let ourScore = 0, oppScore = 0;
    let mvp = "", mvpScore = 0;
    const oppTeamName = Object.keys(otherTeams)[Math.floor(Math.random()*5)];
    const oppPlayers = otherTeams[oppTeamName];
    warriors.forEach(p=>{
      let base = ratingMap[p.rating] || 8;
      let score = base + Math.floor(Math.random()*6);
      ourScore += score;
      if(score > mvpScore) { mvpScore = score; mvp = p.name; }
    });
    oppPlayers.forEach(p=>{
      oppScore += (ratingMap[p.rating] || 8) + Math.floor(Math.random()*6);
    });
    lastSimDate = todayStr;
    const res = document.getElementById("gameResult");
    res.innerHTML = `<h2>æ¨¡æ“¬æ¯”è³½çµæœ ğŸ€</h2>
      <p>å‹‡å£« vs ${oppTeamName}</p>
      <p>æ¯”åˆ†ï¼š<strong>${ourScore} - ${oppScore}</strong></p>
      <p>${ourScore>oppScore ? "ğŸ‰ å‹åˆ©ï¼" : "ğŸ˜¢ è½æ•—..."}</p>
      <p>MVPï¼š${mvp}ï¼ˆå¾—åˆ† ${mvpScore}ï¼‰</p>`;
    saveData();
  }

  function selectTeam() {
    const area = document.getElementById("teamSelectArea");
    area.innerHTML = `
      <h2>é¸æ“‡çƒéšŠ</h2>
      <select id="teamSelect">
        <option value="">è«‹é¸æ“‡</option>
        ${Object.keys(otherTeams).map(t => `<option value="${t}">${t}</option>`).join("")}
      </select>`;
    document.getElementById("teamSelect").addEventListener("change", e => {
      const team = e.target.value;
      if (!team) return;
      const div = document.getElementById("otherTeam");
      div.innerHTML = `<h3>${team} é™£å®¹</h3>` + otherTeams[team].map(p => `
        <div class="player"><div><strong>${p.name}</strong>ï½œè©•åƒ¹ï¼š${p.rating} ${getStar(p.rating)}</div></div>
      `).join("");
    });
  }

  function resetTraining() {
    warriors.forEach(p=>p.trainedToday = false);
    alert("æ‰€æœ‰çƒå“¡ä»Šæ—¥è¨“ç·´å·²é‡ç½®ï¼");
    showWarriors(); saveData();
  }

  document.addEventListener("DOMContentLoaded", () => {
    loadData();
    renderDate();
    showWarriors();
    showFreeAgents();

    document.getElementById("showWarriorsBtn").addEventListener("click", showWarriors);
    document.getElementById("showFreeAgentsBtn").addEventListener("click", showFreeAgents);
    document.getElementById("simulateGameBtn").addEventListener("click", renderDate);
    document.getElementById("selectTeamBtn").addEventListener("click", selectTeam);
    document.getElementById("resetTrainingBtn").addEventListener("click", resetTraining);
    document.getElementById("clearBtn").addEventListener("click", () => {
      if(confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è³‡æ–™ï¼Ÿ")) {
        localStorage.removeItem("sj_gm_data");
        location.reload();
      }
    });
  });
})();
</script>
</body>
</html>
